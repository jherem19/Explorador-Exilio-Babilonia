<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador Interactivo: El Exilio Babil√≥nico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Visualization & Content Choices: 
        Home Page: Introduction text + 3 cards (Image, Title, Description, Button) for "Antes", "Durante", "Despu√©s". Goal: Engaging entry point. Viz: HTML/Tailwind cards. Interaction: Click "Explore" to show detailed section.
        Kings/Governors (in detailed sections): Interactive Timelines (Chart.js). Interaction: Click for detail pane + Gemini "Analizar Impacto".
        Prophetic messages (in detailed sections): Accordion. Interaction: Expand + Gemini "Profundizar Mensaje" + "Ver Vers√≠culos" (Gemini modal).
        Tables, Poetic excerpts, Fuentes: As before, accessed via Home cards or nav, with UI consistency.
        Modal UI: Modern, clean, enhanced typography.
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
            color: #334155; /* slate-700 */
        }
        .nav-logo:hover {
            opacity: 0.8;
        }
        .nav-button.active { /* For Conclusi√≥n and Fuentes */
            color: #0f172a; /* slate-900 */
            font-weight: 600; /* semibold */
            border-bottom-color: #0f172a; /* slate-900 */
        }
         .sub-tab-button.active {
            background-color: #0f172a; /* slate-800 */
            color: white;
            font-weight: 500;
        }
        .sub-tab-button {
            color: #475569; /* slate-600 */
            border-bottom-width: 2px;
            border-color: transparent;
        }
        .sub-tab-button:hover {
            color: #0f172a; /* slate-900 */
            border-bottom-color: #cbd5e1; /* slate-300 */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px; 
            margin-left: auto;
            margin-right: auto;
            height: 400px; 
            max-height: 500px; 
            background-color: #ffffff;
            padding: 1rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); /* shadow */
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 450px;
                padding: 1.5rem;
            }
        }
        .accordion-item {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); /* shadow */
            margin-bottom: 1rem;
        }
        .accordion-header {
            cursor: pointer;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e2e8f0; /* slate-200 */
        }
        .accordion-header:hover {
            background-color: #f8fafc; /* slate-50 */
        }
        .accordion-item.active .accordion-header {
             border-bottom-color: transparent;
        }
        .accordion-content {
            display: none;
            padding: 1.5rem;
            border-top: none;
        }
        .accordion-item.active .accordion-content {
            display: block;
        }
        .accordion-header .arrow {
            transition: transform 0.3s ease;
            display: inline-block;
            margin-left: auto;
            color: #475569; /* slate-600 */
        }
        .accordion-item.active .accordion-header .arrow {
            transform: rotate(90deg);
        }
        th, td {
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0; /* slate-200 */
        }
        th {
            background-color: #f8fafc; /* slate-50 */
            color: #1e293b; /* slate-800 */
            font-weight: 600;
        }
        tr:hover {
            background-color: #f8fafc; /* slate-50 */
        }
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; 
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); /* shadow */
        }
        .action-button { 
            padding: 0.625rem 1.25rem; 
            border-radius: 0.5rem; 
            font-weight: 500; 
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px -1px rgba(0,0,0,0.1); 
        }
        .gemini-button {
             background-color: #1e293b; 
             color: white;
        }
        .gemini-button:hover {
            background-color: #0f172a; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); 
        }
        .verse-modal-button {
            background-color: #0ea5e9; 
            color: white;
        }
        .verse-modal-button:hover {
            background-color: #0284c7; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); 
        }
         .verse-in-text-trigger {
            color: #0ea5e9; 
            text-decoration: underline;
            cursor: pointer;
            font-weight: 500;
         }
         .verse-in-text-trigger:hover {
            color: #0284c7; 
         }
         .fuentes-list {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            padding-left: 1rem;
         }
         .fuentes-list li {
            margin-bottom: 0.5rem; 
         }

        #contentModal .modal-dialog-content {
            background-color: #ffffff; 
            border-radius: 1rem; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); 
            border: 1px solid #e2e8f0; 
            max-height: 90vh; 
            width: 90%;
            max-width: 768px; 
            display: flex;
            flex-direction: column;
        }

        #contentModalTitle {
            padding: 1.5rem; 
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0; 
            color: #1e293b; 
            font-size: 1.5rem; 
            font-weight: 700; 
        }

        #closeContentModal {
            position: absolute;
            top: 1rem; 
            right: 1rem; 
            color: #64748b; 
            font-size: 1.875rem; 
            line-height: 1;
            padding: 0.5rem;
            border-radius: 9999px; 
            transition: background-color 0.2s, color 0.2s;
        }
        #closeContentModal:hover {
            color: #0f172a; 
            background-color: #f1f5f9; 
        }

        #contentResponseArea {
            padding: 1.5rem; 
            line-height: 1.75; 
            color: #334155; 
            flex-grow: 1;
            overflow-y: auto;
        }

        .modal-content-text p { margin-bottom: 1.25rem; }
        .modal-content-text strong { color: #0f172a; font-weight: 600;  }
        .modal-content-text em { font-style: italic; color: #1e293b; }
        .modal-content-text h1, .modal-content-text h2, .modal-content-text h3, .modal-content-text h4, .modal-content-text h5, .modal-content-text h6 {
            font-weight: 600; color: #1e293b; margin-top: 1.75rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #cbd5e1; 
        }
        .modal-content-text h1 { font-size: 1.875rem; } 
        .modal-content-text h2 { font-size: 1.5rem; }    
        .modal-content-text h3 { font-size: 1.25rem; }   
        .modal-content-text h4 { font-size: 1.125rem; }  
        .modal-content-text ul, .modal-content-text ol { margin-left: 0.5rem; margin-bottom: 1.25rem; padding-left: 1.25rem; }
        .modal-content-text ul li, .modal-content-text ol li { margin-bottom: 0.625rem; }
        .modal-content-text ul { list-style-type: disc; }
        .modal-content-text ol { list-style-type: decimal; }
        .modal-content-text blockquote {
            border-left: 4px solid #38bdf8; padding-left: 1.25rem; margin: 1.75rem 0; font-style: italic;
            color: #475569; background-color: #f0f9ff; padding-top: 0.75rem; padding-bottom: 0.75rem; border-radius: 0.375rem; 
        }
        .modal-content-text .verse-number { font-weight: bold; color: #0ea5e9; margin-right: 0.25em; }
        
        .content-card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1); /* shadow-lg */
            padding: 1.5rem; /* p-6 */
            margin-bottom: 2rem; /* mb-8 */
        }
        @media (min-width: 768px) {
            .content-card {
                padding: 2rem; /* p-8 */
            }
        }
        .home-section-card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1); /* shadow-lg */
            overflow: hidden; /* To contain the image */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .home-section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1); /* shadow-xl */
        }
        .home-section-card img {
            width: 100%;
            height: 200px; /* Fixed height for cover images */
            object-fit: cover; /* Crop image to fit */
        }

    </style>
</head>
<body class="bg-slate-100 text-slate-700">

    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center">
                    <button id="homeButton" class="nav-logo focus:outline-none">
                        <span class="font-bold text-2xl text-slate-900">üìú Exilio Babil√≥nico</span>
                    </button>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-1">
                        <button data-tab="conclusion" class="nav-button text-slate-600 hover:text-slate-900 px-4 py-3 rounded-md text-sm font-medium border-b-2 border-transparent">Conclusi√≥n</button>
                        <button data-tab="fuentes" class="nav-button text-slate-600 hover:text-slate-900 px-4 py-3 rounded-md text-sm font-medium border-b-2 border-transparent">Fuentes</button>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-slate-600 hover:text-slate-900 focus:outline-none p-2">
                        <svg class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="md:hidden hidden border-t border-slate-200">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button data-tab="conclusion" class="block nav-button text-slate-600 hover:text-slate-900 hover:bg-slate-100 w-full text-left px-3 py-3 rounded-md text-base font-medium border-b-2 border-transparent">Conclusi√≥n</button>
                <button data-tab="fuentes" class="block nav-button text-slate-600 hover:text-slate-900 hover:bg-slate-100 w-full text-left px-3 py-3 rounded-md text-base font-medium border-b-2 border-transparent">Fuentes</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto py-8 sm:px-6 lg:px-8">
        <section id="home" class="content-section">
            <div class="content-card mb-12">
                <h2 class="text-4xl font-bold text-slate-900 mb-6">Bienvenido al Explorador del Exilio Babil√≥nico</h2>
                <p class="mb-4 text-lg leading-relaxed">Esta aplicaci√≥n interactiva te guiar√° a trav√©s de uno de los per√≠odos m√°s cruciales y transformadores en la historia del antiguo pueblo de Jud√°: el Exilio Babil√≥nico. Exploraremos los eventos que condujeron a la ca√≠da de Jerusal√©n, la vida durante el cautiverio y el subsiguiente retorno y reconstrucci√≥n bajo diversas potencias imperiales.</p>
                <h3 class="text-2xl font-semibold text-slate-800 mt-8 mb-4">Contexto del Exilio</h3>
                <p class="mb-4 leading-relaxed">El exilio babil√≥nico, con sus principales deportaciones en 605, 597 y 586 a.C., no fue solo un desplazamiento geogr√°fico, sino un evento que reconfigur√≥ la identidad, la teolog√≠a y las pr√°cticas del pueblo jud√≠o. La destrucci√≥n del Primer Templo y la interrupci√≥n de la monarqu√≠a dav√≠dica marcaron un antes y un despu√©s, cuyas resonancias se perciben a lo largo de toda la Biblia y en la historia posterior.</p>
                <p class="mb-4 leading-relaxed">Este explorador se centra en el Reino de Jud√° (el Reino del Sur), ya que el Reino del Norte (Israel) hab√≠a sido previamente conquistado y dispersado por Asiria.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-8">
                <div class="home-section-card" data-target-section="antes">
                    <img src="https://placehold.co/600x350/a5f3fc/0e7490?text=Reino+de+Jud%C3%A1+y+Profetas" alt="Imagen alusiva a Antes del Exilio">
                    <div class="p-6">
                        <h3 class="text-2xl font-bold text-slate-900 mb-3">Antes del Exilio</h3>
                        <p class="text-slate-600 mb-4 leading-relaxed text-sm">Los √∫ltimos reyes de Jud√°, las advertencias prof√©ticas y la creciente amenaza babil√≥nica.</p>
                        <button class="action-button gemini-button explore-section-btn w-full" data-target-section="antes">Explorar Secci√≥n</button>
                    </div>
                </div>

                <div class="home-section-card" data-target-section="durante">
                    <img src="https://placehold.co/600x350/fecaca/7f1d1d?text=Exilio+en+Babilonia" alt="Imagen alusiva a Durante el Exilio">
                    <div class="p-6">
                        <h3 class="text-2xl font-bold text-slate-900 mb-3">Durante el Exilio</h3>
                        <p class="text-slate-600 mb-4 leading-relaxed text-sm">La vida en cautiverio, el liderazgo en Judea y Babilonia, y las expresiones de lamento y esperanza.</p>
                        <button class="action-button gemini-button explore-section-btn w-full" data-target-section="durante">Explorar Secci√≥n</button>
                    </div>
                </div>

                <div class="home-section-card" data-target-section="despues">
                    <img src="https://placehold.co/600x350/d1fae5/065f46?text=Retorno+y+Reconstrucci%C3%B3n" alt="Imagen alusiva a Despu√©s del Exilio">
                    <div class="p-6">
                        <h3 class="text-2xl font-bold text-slate-900 mb-3">Despu√©s del Exilio</h3>
                        <p class="text-slate-600 mb-4 leading-relaxed text-sm">El retorno bajo Ciro, la reconstrucci√≥n del Templo y la vida bajo los imperios Persa, Helen√≠stico y Romano.</p>
                        <button class="action-button gemini-button explore-section-btn w-full" data-target-section="despues">Explorar Secci√≥n</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="antes" class="content-section content-card">
            <h2 class="text-4xl font-bold text-slate-900 mb-8">Antes del Exilio Babil√≥nico</h2>
            <p class="mb-8 text-lg leading-relaxed">Este per√≠odo crucial detalla el declive del Reino de Jud√°, gobernado por los √∫ltimos reyes de la Casa de David, y las apremiantes advertencias de los profetas ante la inminente crisis que culminar√≠a con la destrucci√≥n de Jerusal√©n y el Templo. Las tensiones geopol√≠ticas con potencias como Egipto y el emergente Imperio Neobabil√≥nico marcaron profundamente el destino de Jud√°.</p>
            
            <h3 class="text-2xl font-semibold text-slate-800 mb-4">Los √öltimos Reyes de Jud√°</h3>
            <p class="mb-6">La monarqu√≠a dav√≠dica enfrent√≥ sus momentos m√°s dif√≠ciles. Explora la l√≠nea de tiempo de los √∫ltimos reyes y los eventos clave de sus reinados.</p>
            <div class="chart-container mb-10">
                <canvas id="reyesAntesChart"></canvas>
            </div>
            <div id="reyAntesDetalle" class="p-6 bg-slate-50 rounded-xl shadow-md hidden mt-6"></div>

            <h3 class="text-2xl font-semibold text-slate-800 mt-10 mb-4">Voces Prof√©ticas ante la Crisis</h3>
            <p class="mb-6">Profetas como Isa√≠as, Miqueas, Jerem√≠as, Habacuc y Sofon√≠as alzaron sus voces advirtiendo sobre el juicio divino por la infidelidad, la idolatr√≠a y la injusticia social, pero tambi√©n ofreciendo destellos de esperanza y futura restauraci√≥n.</p>
            <div id="profetasAntesAccordion" class="space-y-4">
                </div>
             <h3 class="text-2xl font-semibold text-slate-800 mt-10 mb-4">Tabla Resumen: √öltimos Reyes de Jud√°</h3>
            <div class="table-container">
                <table class="min-w-full">
                    <thead>
                        <tr>
                            <th >Nombre del Rey</th>
                            <th >Fechas (aprox.)</th>
                            <th >Eventos Clave</th>
                        </tr>
                    </thead>
                    <tbody id="tablaReyesAntes" class="divide-y divide-slate-200">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="durante" class="content-section content-card">
            <h2 class="text-4xl font-bold text-slate-900 mb-8">Durante el Exilio Babil√≥nico (c. 597/586 ‚Äì 538 a.C.)</h2>
            <p class="mb-8 text-lg leading-relaxed">El exilio babil√≥nico fue un per√≠odo de profundo trauma y transformaci√≥n. Mientras una parte de la poblaci√≥n permanec√≠a en una Judea desolada bajo administraci√≥n babil√≥nica, otra, incluyendo la √©lite, fue deportada a Babilonia. Este tiempo vio el surgimiento de nuevas formas de liderazgo comunitario y prof√©tico, y expresiones conmovedoras de lamento y esperanza.</p>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-slate-50 p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-semibold text-slate-800 mb-4">Liderazgo en Judea</h3>
                        <h4 class="text-xl font-semibold text-slate-700 mb-2">Gedal√≠as, hijo de Ahicam</h4>
                        <p class="mb-3">Nombrado gobernador por Nabucodonosor sobre el remanente. Intent√≥ pacificar la regi√≥n desde Mizpa, pero fue asesinado, lo que provoc√≥ m√°s caos y la huida de muchos a Egipto (<span class="verse-in-text-trigger" data-verse-ref="2 Reyes 25:22-26">2 Reyes 25:22-26</span>; <span class="verse-in-text-trigger" data-verse-ref="Jeremias 40:7-12; 41:1-10">Jerem√≠as 40:7-12; 41:1-10</span>).</p>
                        <h4 class="text-xl font-semibold text-slate-700 mt-6 mb-2">La Desolaci√≥n Po√©tica: Lamentaciones</h4>
                        <p class="mb-3">Este libro b√≠blico, atribuido tradicionalmente a Jerem√≠as, es una colecci√≥n de poemas que expresan el profundo dolor por la ca√≠da de Jerusal√©n y la destrucci√≥n del Templo. Citan:</p>
                        <blockquote class="border-l-4 border-sky-500 pl-4 italic text-slate-600 my-3 py-2 bg-sky-50 rounded-r-md">
                            <p>"<span class="verse-in-text-trigger" data-verse-ref="Lamentaciones 1:1-11">¬°C√≥mo ha quedado solitaria la ciudad populosa!</span> La grande entre las naciones se ha vuelto como viuda..." (Lamentaciones 1:1a)</p>
                            <p>"<span class="verse-in-text-trigger" data-verse-ref="Lamentaciones 2:1-10">Por esto yo estoy llorando; de mis ojos, de mis ojos fluyen aguas</span>, porque se alej√≥ de m√≠ el consolador que d√© reposo a mi alma..." (Lamentaciones 1:16a)</p>
                             <p>"<span class="verse-in-text-trigger" data-verse-ref="Lamentaciones 3:1-33">Bueno es Jehov√° a los que en √©l esperan, al alma que le busca. Bueno es esperar en silencio la salvaci√≥n de Jehov√°.</span>" (Lamentaciones 3:25-26)</p>
                        </blockquote>
                </div>
                <div class="bg-slate-50 p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-semibold text-slate-800 mb-4">Liderazgo en Babilonia</h3>
                        <h4 class="text-xl font-semibold text-slate-700 mb-2">Estatus del Rey Joaqu√≠n (Jecon√≠as)</h4>
                        <p class="mb-3">Aunque deportado, fue finalmente liberado de prisi√≥n y se le otorg√≥ un estatus de favor en la corte babil√≥nica, manteniendo viva la esperanza mesi√°nica (<span class="verse-in-text-trigger" data-verse-ref="2 Reyes 25:27-30">2 Reyes 25:27-30</span>).</p>
                        
                        <h4 class="text-xl font-semibold text-slate-700 mt-6 mb-2">L√≠deres Prof√©ticos y Comunitarios</h4>
                        <ul class="list-disc list-inside space-y-1 mb-3 pl-2">
                            <li><strong>Ezequiel:</strong> Sacerdote deportado, su ministerio se centr√≥ en explicar el juicio divino y ofrecer visiones de restauraci√≥n, como el valle de los huesos secos (<span class="verse-in-text-trigger" data-verse-ref="Ezequiel 37:1-14">Ezequiel 37:1-14</span>).</li>
                            <li><strong>Daniel:</strong> Sirvi√≥ en cortes imperiales, manteniendo su fidelidad y recibiendo visiones sobre la soberan√≠a de Dios (<span class="verse-in-text-trigger" data-verse-ref="Daniel 1-7">Daniel 1-7</span>).</li>
                            <li><strong>Ancianos:</strong> Mantuvieron estructuras comunitarias, como se infiere de <span class="verse-in-text-trigger" data-verse-ref="Ezequiel 8:1">Ezequiel 8:1</span> y la carta de Jerem√≠as (<span class="verse-in-text-trigger" data-verse-ref="Jeremias 29:1-14">Jerem√≠as 29:1-14</span>).</li>
                        </ul>
                         <h4 class="text-xl font-semibold text-slate-700 mt-6 mb-2">El Lamento Po√©tico en el Exilio: Salmo 137</h4>
                        <blockquote class="border-l-4 border-sky-500 pl-4 italic text-slate-600 my-3 py-2 bg-sky-50 rounded-r-md">
                            <p>"<span class="verse-in-text-trigger" data-verse-ref="Salmo 137:1-9">Junto a los r√≠os de Babilonia, all√≠ nos sent√°bamos, y aun llor√°bamos, acord√°ndonos de Sion. Sobre los sauces en medio de ella colgamos nuestras arpas.</span>" (Salmo 137:1-2)</p>
                        </blockquote>
                </div>
            </div>
            <h3 class="text-2xl font-semibold text-slate-800 mt-10 mb-4">Tabla Resumen: Figuras Clave Durante el Exilio</h3>
            <div class="table-container">
                <table class="min-w-full">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Rol/T√≠tulo</th>
                            <th>Ubicaci√≥n</th>
                            <th>Notas</th>
                        </tr>
                    </thead>
                    <tbody id="tablaFigurasDurante" class="divide-y divide-slate-200">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="despues" class="content-section content-card">
            <h2 class="text-4xl font-bold text-slate-900 mb-8">Despu√©s del Exilio Babil√≥nico</h2>
            <p class="mb-8 text-lg leading-relaxed">Tras el Edicto de Ciro en 538 a.C., que permiti√≥ el retorno de los jud√≠os, comenz√≥ un largo per√≠odo de reconstrucci√≥n y redefinici√≥n bajo sucesivas potencias imperiales. Judea, ahora la provincia persa de Yehud Medinata, vio el liderazgo de gobernadores como Zorobabel y Nehem√≠as, y figuras religiosas como Esdras. Posteriormente, los per√≠odos Helen√≠stico (con la revuelta Macabea y la dinast√≠a Asmonea) y Romano Temprano (con la dinast√≠a Herodiana y los procuradores) trajeron nuevos desaf√≠os y transformaciones.</p>

            <div class="mb-8">
                <div class="border-b border-slate-300">
                    <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                        <button data-subtab="persa" class="sub-tab-button whitespace-nowrap py-4 px-1 font-medium text-md">Per√≠odo Persa</button>
                        <button data-subtab="helenistico" class="sub-tab-button whitespace-nowrap py-4 px-1 font-medium text-md">Per√≠odo Helen√≠stico</button>
                        <button data-subtab="romano" class="sub-tab-button whitespace-nowrap py-4 px-1 font-medium text-md">Per√≠odo Romano Temprano</button>
                    </nav>
                </div>
            </div>

            <div id="persa" class="sub-content-section">
                <h3 class="text-3xl font-semibold text-slate-800 mb-6">Per√≠odo Persa (c. 538 ‚Äì 332 a.C.)</h3>
                <p class="mb-6">Bajo el dominio persa, Judea fue la provincia de Yehud. Gobernadores como Sesbasar y Zorobabel lideraron la reconstrucci√≥n del Templo, mientras Esdras y Nehem√≠as impulsaron reformas religiosas y la reconstrucci√≥n de las murallas de Jerusal√©n. Profetas como Hageo, Zacar√≠as, el "Segundo Isa√≠as" (<span class="verse-in-text-trigger" data-verse-ref="Isaias 40:1-11; 43:1-21; 44:24-45:7; 52:7-12; 54:1-17; 55:1-13">Isa√≠as 40-55</span>) y Malaqu√≠as ofrecieron gu√≠a y esperanza.</p>
                <div class="chart-container mb-10">
                    <canvas id="gobernadoresPersaChart"></canvas>
                </div>
                <div id="gobernadorPersaDetalle" class="p-6 bg-slate-50 rounded-xl shadow-md hidden mt-6"></div>
                <h4 class="text-xl font-semibold text-slate-800 mt-8 mb-4">Tabla Resumen: Gobernadores Persas (Selecci√≥n)</h4>
                <div class="table-container">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>Gobernador</th>
                                <th>Fechas (aprox.)</th>
                                <th>Logros Clave</th>
                            </tr>
                        </thead>
                        <tbody id="tablaGobernadoresPersa" class="divide-y divide-slate-200"></tbody>
                    </table>
                </div>
            </div>

            <div id="helenistico" class="sub-content-section hidden">
                <h3 class="text-3xl font-semibold text-slate-800 mb-6">Per√≠odo Helen√≠stico (c. 332 ‚Äì 63 a.C.)</h3>
                <p class="mb-6">Tras Alejandro Magno, Judea estuvo bajo Ptolomeos y Sel√©ucidas. La helenizaci√≥n forzada bajo Ant√≠oco IV Ep√≠fanes provoc√≥ la Revuelta Macabea, que llev√≥ a la independencia bajo la Dinast√≠a Asmonea (Judas Macabeo, Sim√≥n, Juan Hircano I, etc.). Conflictos internos finalmente abrieron paso a la intervenci√≥n romana.</p>
                 <div class="chart-container mb-10">
                    <canvas id="gobernadoresAsmoneoChart"></canvas>
                </div>
                <div id="gobernadorAsmoneoDetalle" class="p-6 bg-slate-50 rounded-xl shadow-md hidden mt-6"></div>
                <h4 class="text-xl font-semibold text-slate-800 mt-8 mb-4">Tabla Resumen: Gobernantes Asmoneos (Selecci√≥n)</h4>
                <div class="table-container">
                     <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>Gobernante</th>
                                <th>T√≠tulo(s)</th>
                                <th>Fechas (a.C.)</th>
                                <th>Eventos Clave</th>
                            </tr>
                        </thead>
                        <tbody id="tablaGobernadoresAsmoneos" class="divide-y divide-slate-200"></tbody>
                    </table>
                </div>
            </div>

            <div id="romano" class="sub-content-section hidden">
                <h3 class="text-3xl font-semibold text-slate-800 mb-6">Per√≠odo Romano Temprano (Desde 63 a.C.)</h3>
                <p class="mb-6">La intervenci√≥n de Pompeyo en 63 a.C. inici√≥ la dominaci√≥n romana. La Dinast√≠a Herodiana (Herodes el Grande y sus sucesores) gobern√≥ como reyes clientes. Cuando Judea fue provincia romana, fue administrada por prefectos y procuradores (Poncio Pilato, F√©lix, Florus), cuyo gobierno a menudo exacerb√≥ las tensiones que llevaron a la Primera Revuelta Jud√≠a.</p>
                 <div class="chart-container mb-10">
                    <canvas id="gobernadoresRomanoChart"></canvas>
                </div>
                <div id="gobernadorRomanoDetalle" class="p-6 bg-slate-50 rounded-xl shadow-md hidden mt-6"></div>
                <h4 class="text-xl font-semibold text-slate-800 mt-8 mb-4">Tabla Resumen: Gobernantes Romanos Tempranos (Selecci√≥n)</h4>
                 <div class="table-container">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>Gobernante</th>
                                <th>T√≠tulo(s)</th>
                                <th>Fechas (aprox.)</th>
                                <th>Notas</th>
                            </tr>
                        </thead>
                        <tbody id="tablaGobernadoresRomanos" class="divide-y divide-slate-200"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="conclusion" class="content-section content-card">
            <h2 class="text-4xl font-bold text-slate-900 mb-8">Conclusi√≥n: Legado y Transformaci√≥n</h2>
            <p class="mb-6 text-lg leading-relaxed">El per√≠odo que abarca desde los √∫ltimos reyes de Jud√° hasta la dominaci√≥n romana temprana fue una √©poca de profundas transformaciones para el pueblo jud√≠o. A pesar de la p√©rdida de soberan√≠a pol√≠tica y la destrucci√≥n del Templo, la fe, la identidad y las tradiciones no solo sobrevivieron sino que se adaptaron y evolucionaron.</p>
            
            <h3 class="text-2xl font-semibold text-slate-800 mt-8 mb-4">Continuidades y Discontinuidades</h3>
            <p class="mb-4 leading-relaxed">Se mantuvieron continuidades clave como la esperanza mesi√°nica dav√≠dica, la centralidad de la Ley Mosaica (Tor√°) y, tras su reconstrucci√≥n, el Templo. Sin embargo, el liderazgo se fragment√≥, la di√°spora creci√≥ y la soberan√≠a se vio dr√°sticamente alterada, pasando de monarcas aut√≥nomos a reyes clientes y administradores imperiales.</p>

            <h3 class="text-2xl font-semibold text-slate-800 mt-8 mb-4">Evoluci√≥n de la Soberan√≠a</h3>
            <p class="mb-4 leading-relaxed">La "realeza" pas√≥ de ser una monarqu√≠a dav√≠dica a un rey exiliado simb√≥lico, luego a gobernadores provinciales bajo Persia, reyes-sumos sacerdotes asmoneos con independencia condicionada, y finalmente a reyes clientes herodianos y administradores romanos. Esta evoluci√≥n refleja la constante lucha por la autonom√≠a frente a poderes imperiales.</p>

            <h3 class="text-2xl font-semibold text-slate-800 mt-8 mb-4">Impacto Duradero</h3>
            <p class="mb-4 leading-relaxed">Las experiencias bajo sucesivos imperios forjaron el juda√≠smo. Las tensiones entre tradici√≥n y asimilaci√≥n, autonom√≠a e imperio, y las facciones internas, configuraron su desarrollo. Este complejo panorama tambi√©n fue el crisol del cristianismo primitivo.</p>
            <p class="leading-relaxed">Las profec√≠as de restauraci√≥n (<span class="verse-in-text-trigger" data-verse-ref="Isaias 40:1-11; 43:1-21; 44:24-45:7; 52:7-12; 54:1-17; 55:1-13">Isa√≠as 40-55</span>; <span class="verse-in-text-trigger" data-verse-ref="Jeremias 30-31">Jerem√≠as 30-31</span>; <span class="verse-in-text-trigger" data-verse-ref="Ezequiel 37:1-14">Ezequiel 37</span>) y los lamentos po√©ticos (<span class="verse-in-text-trigger" data-verse-ref="Salmo 137:1-9">Salmo 137</span>; <span class="verse-in-text-trigger" data-verse-ref="Lamentaciones 1:1-11; 2:1-10; 3:1-33; 5:1-22">Lamentaciones</span>) continuaron alimentando la fe y la esperanza a trav√©s de los siglos, demostrando una notable resiliencia espiritual y cultural.</p>
        </section>

        <section id="fuentes" class="content-section content-card">
            <h2 class="text-4xl font-bold text-slate-900 mb-8">Fuentes Bibliogr√°ficas y Pasajes Clave</h2>
            <p class="mb-8 text-lg leading-relaxed">Esta aplicaci√≥n se basa en la informaci√≥n contenida en los textos b√≠blicos y se complementa con interpretaciones hist√≥ricas y arqueol√≥gicas. A continuaci√≥n, se presenta un resumen de las fuentes primarias y algunos de los pasajes m√°s relevantes.</p>

            <h3 class="text-2xl font-semibold text-slate-800 mb-4">Fuentes Bibliogr√°ficas Primarias</h3>
            <ul class="fuentes-list text-md">
                <li><strong>Libros Hist√≥ricos:</strong> 1 y 2 Reyes, 1 y 2 Cr√≥nicas, Esdras, Nehem√≠as.</li>
                <li><strong>Libros Prof√©ticos (Mayores):</strong> Isa√≠as, Jerem√≠as, Lamentaciones, Ezequiel, Daniel.</li>
                <li><strong>Libros Prof√©ticos (Menores):</strong> Hageo, Zacar√≠as, Malaqu√≠as, Miqueas, Nah√∫m, Habacuc, Sofon√≠as, Abd√≠as.</li>
                <li><strong>Libros Po√©ticos/Sapienciales:</strong> Salmos (especialmente <span class="verse-in-text-trigger" data-verse-ref="Salmo 137:1-9">Salmo 137</span>).</li>
                <li><strong>Libros Deuterocan√≥nicos/Ap√≥crifos (contexto helen√≠stico):</strong> 1 y 2 Macabeos.</li>
            </ul>

            <h3 class="text-2xl font-semibold text-slate-800 mt-8 mb-4">Fuentes Acad√©micas (Referencia General)</h3>
            <p class="mb-8 leading-relaxed">El contenido de esta aplicaci√≥n integra la informaci√≥n de las Sagradas Escrituras con hallazgos arqueol√≥gicos y estudios de eruditos en historia del Antiguo Cercano Oriente, cronolog√≠a b√≠blica y estudios del Segundo Templo. Las referencias espec√≠ficas a obras acad√©micas y cronolog√≠as detalladas (como las de W.F. Albright, E.R. Thiele, G. Galil, K.A. Kitchen, y otras citadas en el informe original con n√∫meros como [1] a [14]) pueden consultarse en el documento base que inspir√≥ esta aplicaci√≥n.</p>

            <h3 class="text-2xl font-semibold text-slate-800 mt-8 mb-4">Pasajes B√≠blicos Clave por Per√≠odo</h3>
            
            <h4 class="text-xl font-semibold text-slate-700 mt-6 mb-3">Antes del Exilio:</h4>
            <ul class="fuentes-list text-md">
                <li>Reforma de Jos√≠as y hallazgo de la Ley: <span class="verse-in-text-trigger" data-verse-ref="2 Reyes 23:1-25">2 Reyes 23:1-25</span>; <span class="verse-in-text-trigger" data-verse-ref="2 Cronicas 34:29-33; 35:20-24">2 Cr√≥nicas 34:29-33; 35:20-24</span>.</li>
                <li>Reinado de Joacim y quema del rollo de Jerem√≠as: <span class="verse-in-text-trigger" data-verse-ref="Jeremias 36">Jerem√≠as 36</span>.</li>
                <li>Primera deportaci√≥n (Daniel y compa√±eros): <span class="verse-in-text-trigger" data-verse-ref="Daniel 1:1-7">Daniel 1:1-7</span>.</li>
                <li>Segunda deportaci√≥n (Rey Joaqu√≠n, Ezequiel): <span class="verse-in-text-trigger" data-verse-ref="2 Reyes 24:8-17">2 Reyes 24:8-17</span>; <span class="verse-in-text-trigger" data-verse-ref="Ezequiel 1:1-3">Ezequiel 1:1-3</span>.</li>
                <li>Reinado de Sedequ√≠as y advertencias de Jerem√≠as: <span class="verse-in-text-trigger" data-verse-ref="Jeremias 38:14-28">Jerem√≠as 38:14-28</span>.</li>
                <li>Ca√≠da de Jerusal√©n y destrucci√≥n del Templo: <span class="verse-in-text-trigger" data-verse-ref="2 Reyes 25:1-21">2 Reyes 25:1-21</span>; <span class="verse-in-text-trigger" data-verse-ref="Jeremias 39:1-10">Jerem√≠as 39:1-10</span>, <span class="verse-in-text-trigger" data-verse-ref="Jeremias 52:4-30">52:4-30</span>; <span class="verse-in-text-trigger" data-verse-ref="2 Cronicas 36:11-21">2 Cr√≥nicas 36:11-21</span>.</li>
                <li>Profec√≠as de Isa√≠as sobre el juicio y la cautividad: <span class="verse-in-text-trigger" data-verse-ref="Isaias 1:2-20">Isa√≠as 1:2-20</span>, <span class="verse-in-text-trigger" data-verse-ref="Isaias 5:1-7, 13-17, 24-25">5:1-7, 13-17, 24-25</span>, <span class="verse-in-text-trigger" data-verse-ref="Isaias 39">39</span>.</li>
                <li>Profec√≠as de Miqueas sobre la destrucci√≥n y el exilio: <span class="verse-in-text-trigger" data-verse-ref="Miqueas 3:9-12">Miqueas 3:9-12</span>, <span class="verse-in-text-trigger" data-verse-ref="Miqueas 4:10">4:10</span>.</li>
                <li>Profec√≠as de Habacuc sobre los babilonios: <span class="verse-in-text-trigger" data-verse-ref="Habacuc 1:1-11; 2:1-4">Habacuc 1:1-11; 2:1-4</span>.</li>
                <li>Profec√≠as de Sofon√≠as sobre el D√≠a del Se√±or: <span class="verse-in-text-trigger" data-verse-ref="Sofonias 1:14-18; 3:1-8">Sofon√≠as 1:14-18; 3:1-8</span>.</li>
            </ul>

            <h4 class="text-xl font-semibold text-slate-700 mt-6 mb-3">Durante el Exilio:</h4>
            <ul class="fuentes-list text-md">
                <li>Gobernaci√≥n y asesinato de Gedal√≠as: <span class="verse-in-text-trigger" data-verse-ref="2 Reyes 25:22-26">2 Reyes 25:22-26</span>; <span class="verse-in-text-trigger" data-verse-ref="Jeremias 40:7-12; 41:1-10">Jerem√≠as 40:7-12; 41:1-10</span>.</li>
                <li>Lamento por Jerusal√©n: Libro de <span class="verse-in-text-trigger" data-verse-ref="Lamentaciones">Lamentaciones</span> (ej. <span class="verse-in-text-trigger" data-verse-ref="Lamentaciones 1:1-11">1:1-11</span>, <span class="verse-in-text-trigger" data-verse-ref="Lamentaciones 2:1-10">2:1-10</span>, <span class="verse-in-text-trigger" data-verse-ref="Lamentaciones 3:1-33">3:1-33</span>, <span class="verse-in-text-trigger" data-verse-ref="Lamentaciones 5:1-22">5:1-22</span>).</li>
                <li>Ministerio de Ezequiel en Babilonia: Libro de <span class="verse-in-text-trigger" data-verse-ref="Ezequiel">Ezequiel</span> (ej. <span class="verse-in-text-trigger" data-verse-ref="Ezequiel 18">18</span>, <span class="verse-in-text-trigger" data-verse-ref="Ezequiel 37:1-14">37:1-14</span>, <span class="verse-in-text-trigger" data-verse-ref="Ezequiel 40:1-4; 43:1-7; 47:1-12">40:1-4; 43:1-7; 47:1-12</span>).</li>
                <li>Ministerio de Daniel en Babilonia: Libro de <span class="verse-in-text-trigger" data-verse-ref="Daniel">Daniel</span> (ej. <span class="verse-in-text-trigger" data-verse-ref="Daniel 2">2</span>, <span class="verse-in-text-trigger" data-verse-ref="Daniel 6">6</span>, <span class="verse-in-text-trigger" data-verse-ref="Daniel 9:1-19">9:1-19</span>).</li>
                <li>Carta de Jerem√≠as a los exiliados: <span class="verse-in-text-trigger" data-verse-ref="Jeremias 29:1-14">Jerem√≠as 29:1-14</span>.</li>
                <li>Lamento de los exiliados: <span class="verse-in-text-trigger" data-verse-ref="Salmo 137:1-9">Salmo 137:1-9</span>.</li>
                <li>Liberaci√≥n del rey Joaqu√≠n: <span class="verse-in-text-trigger" data-verse-ref="2 Reyes 25:27-30">2 Reyes 25:27-30</span>; <span class="verse-in-text-trigger" data-verse-ref="Jeremias 52:31-34">Jerem√≠as 52:31-34</span>.</li>
            </ul>

            <h4 class="text-xl font-semibold text-slate-700 mt-6 mb-3">Despu√©s del Exilio:</h4>
            <ul class="fuentes-list text-md">
                <li>Edicto de Ciro y primer retorno: <span class="verse-in-text-trigger" data-verse-ref="Esdras 1:1-11">Esdras 1:1-11</span>; <span class="verse-in-text-trigger" data-verse-ref="2 Cronicas 36:22-23">2 Cr√≥nicas 36:22-23</span>.</li>
                <li>Reconstrucci√≥n del Templo (Zorobabel y Jes√∫a): <span class="verse-in-text-trigger" data-verse-ref="Esdras 3:1-13; 4:1-5, 24; 5:1-5; 6:1-18">Esdras 3:1-13; 4:1-5, 24; 5:1-5; 6:1-18</span>; Libros de <span class="verse-in-text-trigger" data-verse-ref="Hageo 1:1-15; 2:1-9">Hageo</span> y <span class="verse-in-text-trigger" data-verse-ref="Zacarias 1:1-6, 12-17; 4:1-10; 8:1-17">Zacar√≠as 1:1-6, 12-17; 4:1-10; 8:1-17</span>.</li>
                <li>Ministerio de Esdras (ense√±anza de la Ley, matrimonios mixtos): <span class="verse-in-text-trigger" data-verse-ref="Esdras 7:1-10, 27-28; 9:1-15; 10:1-17">Esdras 7:1-10, 27-28; 9:1-15; 10:1-17</span>; <span class="verse-in-text-trigger" data-verse-ref="Nehemias 8:1-12">Nehem√≠as 8:1-12</span>.</li>
                <li>Ministerio de Nehem√≠as (reconstrucci√≥n de murallas, reformas): Libro de <span class="verse-in-text-trigger" data-verse-ref="Nehemias">Nehem√≠as</span> (ej. <span class="verse-in-text-trigger" data-verse-ref="Nehemias 2:11-20; 4:1-23; 6:1-16">2:11-20; 4:1-23; 6:1-16</span>, <span class="verse-in-text-trigger" data-verse-ref="Nehemias 13:4-31">13:4-31</span>).</li>
                <li>Profec√≠as de restauraci√≥n y esperanza del "Segundo Isa√≠as": <span class="verse-in-text-trigger" data-verse-ref="Isaias 40:1-11">Isa√≠as 40:1-11</span>, <span class="verse-in-text-trigger" data-verse-ref="Isaias 43:1-21">43:1-21</span>, <span class="verse-in-text-trigger" data-verse-ref="Isaias 44:24-45:7">44:24-45:7</span>, <span class="verse-in-text-trigger" data-verse-ref="Isaias 52:7-12">52:7-12</span>, <span class="verse-in-text-trigger" data-verse-ref="Isaias 54:1-17">54:1-17</span>, <span class="verse-in-text-trigger" data-verse-ref="Isaias 55:1-13">55:1-13</span>.</li>
                <li>Profec√≠as de Malaqu√≠as sobre la reforma post-ex√≠lica: Libro de <span class="verse-in-text-trigger" data-verse-ref="Malaquias 1:6-14; 2:17-3:5; 3:13-4:3">Malaqu√≠as</span>.</li>
                <li>Contexto de la Revuelta Macabea: Libros de <span class="verse-in-text-trigger" data-verse-ref="1 Macabeos 1:10-64; 2:1-28; 4:36-61">1 Macabeos</span> y <span class="verse-in-text-trigger" data-verse-ref="2 Macabeos 6:18-7:42">2 Macabeos</span>.</li>
                <li>Profec√≠as de Daniel sobre imperios y el futuro: <span class="verse-in-text-trigger" data-verse-ref="Daniel 7:1-28; 8:1-27; 9:20-27; 11:21-45; 12:1-4">Daniel 7-12</span>.</li>
            </ul>
        </section>


    <div id="contentModal" class="fixed inset-0 bg-slate-900 bg-opacity-75 overflow-y-auto h-full w-full flex items-center justify-center hidden z-[100] p-4">
        <div class="modal-dialog-content relative w-full">
            <div class="flex justify-between items-center">
                <h4 id="contentModalTitle" class="text-xl font-semibold text-slate-800">Informaci√≥n</h4>
                <button id="closeContentModal" class="text-slate-500 hover:text-slate-900">
                    <svg class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="contentLoading" class="text-center py-10 hidden">
                <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-slate-700 mx-auto"></div>
                <p class="mt-4 text-slate-600 text-lg">Procesando, por favor espera...</p>
            </div>
            <div id="contentResponseArea" class="text-slate-700 modal-content-text">
            </div>
        </div>
    </div>


    <footer class="bg-white mt-16 border-t border-slate-200">
        <div class="max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8 text-center text-slate-500 text-sm">
            <p>&copy; 2024 Explorador Interactivo del Exilio Babil√≥nico. Contenido adaptado del informe.</p>
        </div>
    </footer>

<script>
    // Data extracted from the report
    const reyesAntesDelExilioData = [
        { nombre: "Jos√≠as", fechas: "640‚Äì609 a.C.", eventos: "Reforma religiosa (2 Reyes 22-23). Muri√≥ en Meguido (2 Reyes 23:29-30).", detalles: "Considerado un rey 'bueno', impuls√≥ una profunda reforma religiosa tras el hallazgo del 'Libro de la Ley'. Muri√≥ tr√°gicamente en batalla, marcando un punto de inflexi√≥n para Jud√°." },
        { nombre: "Joacaz (Salum)", fechas: "609 a.C. (3 meses)", eventos: "Depuesto y exiliado a Egipto por Necao II (2 Reyes 23:31-34).", detalles: "Rein√≥ brevemente antes de ser depuesto por el Fara√≥n Necao II, evidenciando la p√©rdida de autonom√≠a de Jud√°." },
        { nombre: "Joacim (Eliaquim)", fechas: "609‚Äì598 a.C.", eventos: "Vasallo de Egipto, luego de Babilonia. Primera deportaci√≥n (605 a.C.) (Daniel 1:1-7). Rebeli√≥n contra Babilonia. Quem√≥ el rollo de Jerem√≠as (Jerem√≠as 36).", detalles: "Instalado por Egipto, luego sometido a Babilonia. Se rebel√≥, ignorando a Jerem√≠as. Quem√≥ las profec√≠as, mostrando su desaf√≠o." },
        { nombre: "Joaqu√≠n (Jecon√≠as)", fechas: "598‚Äì597 a.C. (3 meses)", eventos: "Se rindi√≥ a Nabucodonosor. Segunda deportaci√≥n (597 a.C.) (2 Reyes 24:10-16).", detalles: "Rein√≥ brevemente y se rindi√≥ a Babilonia, lo que llev√≥ a una deportaci√≥n masiva de la √©lite, incluyendo a Ezequiel. Fue liberado m√°s tarde en Babilonia." },
        { nombre: "Sedequ√≠as (Matan√≠as)", fechas: "597‚Äì586 a.C.", eventos: "Instalado por Nabucodonosor. Rebeli√≥n contra Babilonia. Destrucci√≥n de Jerusal√©n y el Templo (586 a.C.) (2 Reyes 25). Tercera deportaci√≥n.", detalles: "√öltimo rey de Jud√°. A pesar de su juramento, se rebel√≥ contra Babilonia, lo que llev√≥ al asedio final, la destrucci√≥n del Templo y su propio terrible destino." }
    ];

    const profetasAntesData = [
        { nombre: "Isa√≠as", mensaje: "Denunci√≥ la rebeli√≥n de Jud√° (Isa√≠as 1), la corrupci√≥n social (Isa√≠as 5) y predijo la cautividad babil√≥nica (Isa√≠as 39). Ofreci√≥ visiones de juicio y restauraci√≥n mesi√°nica.", versiculos: "Isa√≠as 1:2-20, 5:1-7, 39:1-8" },
        { nombre: "Miqueas", mensaje: "Predic√≥ contra la opresi√≥n y la corrupci√≥n. Anunci√≥ la destrucci√≥n de Jerusal√©n (Miqueas 3:12) y el exilio a Babilonia (Miqueas 4:10), pero tambi√©n una futura restauraci√≥n y un gobernante de Bel√©n (Miqueas 5:2).", versiculos: "Miqueas 3:9-12, 4:9-10, 5:2-4" },
        { nombre: "Nah√∫m", mensaje: "Su profec√≠a se centra en la ca√≠da de N√≠nive, capital asiria (Nah√∫m 1-3). La destrucci√≥n de Asiria abri√≥ camino al ascenso de Babilonia.", versiculos: "Nah√∫m 1:1-15, 2:1-13, 3:1-19" },
        { nombre: "Habacuc", mensaje: "Luch√≥ con la justicia de Dios al usar a los babilonios para castigar a Jud√° (Habacuc 1:6, 12-17). Concluye con una oraci√≥n de fe (Habacuc 3). Famoso por 'el justo por su fe vivir√°' (Habacuc 2:4).", versiculos: "Habacuc 1:1-17, 2:1-4, 3:1-19" },
        { nombre: "Sofon√≠as", mensaje: "Proclam√≥ el inminente 'd√≠a del Se√±or' como juicio sobre Jud√° y las naciones (Sofon√≠as 1:14-18). Ofreci√≥ esperanza para un remanente purificado (Sofon√≠as 3:9-20).", versiculos: "Sofon√≠as 1:14-18, 3:1-8, 3:9-20" },
        { nombre: "Jerem√≠as", mensaje: "El 'profeta llor√≥n'. Denunci√≥ la falsa seguridad en el Templo (Jerem√≠as 7) y la corrupci√≥n. Anunci√≥ 70 a√±os de cautiverio (Jerem√≠as 25:11-12) y aconsej√≥ sumisi√≥n a Babilonia (Jerem√≠as 27).", versiculos: "Jerem√≠as 7:1-15, 25:1-14, 27:1-22, 29:1-14" }
    ];
    
    const figurasDuranteData = [
        { nombre: "Gedal√≠as, hijo de Ahicam", rol: "Gobernador de Judea", ubicacion: "Judea (Mizpa)", notas: "Nombrado por Nabucodonosor (2 Reyes 25:22). Asesinado (Jerem√≠as 41)." },
        { nombre: "Joaqu√≠n (Jecon√≠as)", rol: "Rey exiliado de Jud√°", ubicacion: "Babilonia", notas: "Liberado y honrado por Evil-Merodac (2 Reyes 25:27-30)." },
        { nombre: "Ezequiel", rol: "Profeta, Sacerdote", ubicacion: "Babilonia", notas: "Profetiz√≥ juicio y restauraci√≥n (Ezequiel 37, 40-48)." },
        { nombre: "Daniel", rol: "Profeta, Funcionario de la corte", ubicacion: "Babilonia/Persia", notas: "Sirvi√≥ en cortes imperiales; visiones apocal√≠pticas (Daniel 2, 7)." },
        { nombre: "Ancianos", rol: "L√≠deres comunitarios", ubicacion: "Babilonia", notas: "Mantuvieron cohesi√≥n social y religiosa (Ezequiel 8:1; Jerem√≠as 29:1)." },
        { nombre: "Autores de Lamentaciones", rol: "Poetas/Cronistas", ubicacion: "Judea/Babilonia", notas: "Expresaron el trauma del exilio." },
        { nombre: "Salmistas (ej. Salmo 137)", rol: "Poetas", ubicacion: "Babilonia", notas: "Articularon el dolor y el anhelo de los exiliados." }
    ];

    const gobernadoresPersaData = [
        { nombre: "Sesbasar", fechas: "c. 538 a.C. en adelante", logros: "Lider√≥ el primer retorno. Inici√≥ la reconstrucci√≥n del Templo.", detalles: "Nombrado 'pr√≠ncipe de Jud√°' por Ciro, devolvi√≥ los utensilios del Templo y puso los cimientos del Segundo Templo (Esdras 1, 5)." },
        { nombre: "Zorobabel", fechas: "c. 520 ‚Äì c. 510 a.C.", logros: "Descendiente de David. Complet√≥ la reconstrucci√≥n del Segundo Templo.", detalles: "Gobernador de linaje dav√≠dico, complet√≥ el Templo con el Sumo Sacerdote Jes√∫a, animado por Hageo y Zacar√≠as (Esdras 3-6)." },
        { nombre: "Esdras", fechas: "Llegada c. 458 o 398 a.C.", logros: "Sacerdote y escriba. Reformas religiosas basadas en la Ley.", detalles: "Lider√≥ un retorno y promulg√≥ la Ley de Mois√©s, enfoc√°ndose en la pureza comunitaria y la disoluci√≥n de matrimonios mixtos (Esdras 7-10)." },
        { nombre: "Nehem√≠as", fechas: "1er t√©rmino: 445‚Äì433 a.C.", logros: "Copero real. Reconstruy√≥ las murallas de Jerusal√©n.", detalles: "Nombrado gobernador por Artajerjes I, reconstruy√≥ las murallas de Jerusal√©n e implement√≥ reformas sociales y religiosas (Nehem√≠as)." }
    ];
    
    const gobernadoresAsmoneosData = [
        { nombre: "Judas Macabeo", titulo: "L√≠der Militar", fechas: "c. 166‚Äì160 a.C.", eventos: "Lider√≥ la revuelta; purific√≥ el Templo (1 Macabeos 3-4).", detalles: "Hijo de Matat√≠as, lider√≥ la Revuelta Macabea, logrando victorias clave y la rededicaci√≥n del Templo (Hanukkah)." },
        { nombre: "Jonat√°n Macabeo", titulo: "L√≠der, Sumo Sacerdote", fechas: "c. 160‚Äì143 a.C.", eventos: "Nombrado Sumo Sacerdote (1 Macabeos 10).", detalles: "Hermano de Judas, uni√≥ liderazgo pol√≠tico-militar con el sumo sacerdocio." },
        { nombre: "Sim√≥n Macabeo", titulo: "Etnarca, Sumo Sacerdote", fechas: "142‚Äì135 a.C.", eventos: "Logr√≥ la independencia pol√≠tica (1 Macabeos 13-14).", detalles: "√öltimo de los hermanos, obtuvo independencia y fue proclamado l√≠der hereditario." },
        { nombre: "Juan Hircano I", titulo: "Etnarca, Sumo Sacerdote", fechas: "135/134‚Äì104 a.C.", eventos: "Expandi√≥ el territorio.", detalles: "Hijo de Sim√≥n, expandi√≥ Judea, conquist√≥ Idumea y Samaria." },
        { nombre: "Arist√≥bulo I", titulo: "Rey, Sumo Sacerdote", fechas: "104‚Äì103 a.C.", eventos: "Primer asmoneo en tomar el t√≠tulo de 'Rey'.", detalles: "Primer Asmoneo en autoproclamarse Rey." },
        { nombre: "Alejandro Janneo", titulo: "Rey, Sumo Sacerdote", fechas: "103‚Äì76 a.C.", eventos: "Expansi√≥n militar; conflictos internos.", detalles: "Rein√≥ con expansi√≥n y severos conflictos internos, especialmente con los Fariseos." },
        { nombre: "Salom√© Alejandra", titulo: "Reina", fechas: "76‚Äì67 a.C.", eventos: "√önica reina asmonea; per√≠odo de paz.", detalles: "Esposa de Arist√≥bulo I y Alejandro Janneo, gobern√≥ en un per√≠odo de paz, favoreciendo a los Fariseos." },
        { nombre: "Hircano II", titulo: "Rey (brevemente), Etnarca, Sumo Sacerdote", fechas: "67; 63‚Äì40 a.C.", eventos: "Guerra civil; restaurado por Pompeyo.", detalles: "Involucrado en guerra civil con su hermano Arist√≥bulo II, lo que llev√≥ a la intervenci√≥n romana." },
        { nombre: "Arist√≥bulo II", titulo: "Rey, Sumo Sacerdote", fechas: "67‚Äì63 a.C.", eventos: "Derroc√≥ a Hircano II; depuesto por Pompeyo.", detalles: "Luch√≥ contra Hircano II por el poder, fue depuesto por Pompeyo." },
        { nombre: "Ant√≠gono Matat√≠as", titulo: "Rey, Sumo Sacerdote", fechas: "40‚Äì37 a.C.", eventos: "√öltimo rey asmoneo; ejecutado por los romanos.", detalles: "√öltimo rey Asmoneo, instalado con ayuda parta, fue derrotado y ejecutado por Herodes y los romanos." }
    ];

    const gobernadoresRomanosData = [
        { nombre: "Herodes I el Grande", titulo: "Rey de Judea", fechas: "40/37‚Äì4 a.C.", notas: "Reconstrucci√≥n del Templo; gobierno tir√°nico.", detalles: "Nombrado por Roma, fue un gran constructor (incluyendo la expansi√≥n del Templo) pero tambi√©n un gobernante cruel y paranoico." },
        { nombre: "Herodes Arquelao", titulo: "Etnarca", fechas: "4 a.C.‚Äì6 d.C.", notas: "Depuesto; Judea se convierte en provincia romana.", detalles: "Hijo de Herodes, gobern√≥ Judea, Samaria e Idumea. Su brutalidad llev√≥ a su deposici√≥n por Roma." },
        { nombre: "Herodes Antipas", titulo: "Tetrarca", fechas: "4 a.C.‚Äì39 d.C.", notas: "Gobern√≥ Galilea y Perea. Ejecut√≥ a Juan el Bautista.", detalles: "Hijo de Herodes, gobern√≥ Galilea y Perea. Conocido por su rol en los Evangelios." },
        { nombre: "Herodes Agripa I", titulo: "Rey", fechas: "37/41‚Äì44 d.C.", notas: "Reunific√≥ brevemente el reino.", detalles: "Nieto de Herodes el Grande, amigo de emperadores romanos, reuni√≥ gran parte del reino de su abuelo y fue popular entre algunos jud√≠os." },
        { nombre: "Poncio Pilato", titulo: "Prefecto de Judea", fechas: "26‚Äì36 d.C.", notas: "Juicio y crucifixi√≥n de Jes√∫s.", detalles: "Gobernador romano de Judea, conocido por su papel en el juicio de Jes√∫s. Su mandato fue conflictivo." },
        { nombre: "Gessius Florus", titulo: "Procurador de Judea", fechas: "64‚Äì66 d.C.", notas: "Su mal gobierno contribuy√≥ a la Primera Revuelta Jud√≠a.", detalles: "√öltimo procurador antes de la Primera Revuelta Jud√≠a; su corrupci√≥n y brutalidad fueron un detonante clave del conflicto." }
    ];

    document.addEventListener('DOMContentLoaded', function() {
        const navButtons = document.querySelectorAll('.nav-button'); // For Conclusi√≥n, Fuentes
        const homeButton = document.getElementById('homeButton');
        const mobileMenuNavButtons = document.querySelectorAll('#mobile-menu .nav-button');
        const exploreSectionButtons = document.querySelectorAll('.explore-section-btn');
        
        const allContentSections = document.querySelectorAll('.content-section');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        
        const contentModal = document.getElementById('contentModal');
        const contentModalTitle = document.getElementById('contentModalTitle');
        const closeContentModalButton = document.getElementById('closeContentModal');
        const contentLoading = document.getElementById('contentLoading');
        const contentResponseArea = document.getElementById('contentResponseArea');

        function showContentModal() { contentModal.classList.remove('hidden'); }
        function hideContentModal() { contentModal.classList.add('hidden'); contentLoading.classList.add('hidden'); contentResponseArea.innerHTML = ''; }
        function showContentLoading() { contentLoading.classList.remove('hidden'); contentResponseArea.innerHTML = ''; }
        function setContentResponse(html) { contentLoading.classList.add('hidden'); contentResponseArea.innerHTML = html; }

        closeContentModalButton.addEventListener('click', hideContentModal);
        contentModal.addEventListener('click', function(event) {
            if (event.target === contentModal) { 
                hideContentModal();
            }
        });

        async function callGeminiAPIForAnalysis(prompt, modalTitle) {
            contentModalTitle.textContent = modalTitle;
            showContentModal();
            showContentLoading();
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(`API Error: ${response.status} ${response.statusText}. Details: ${JSON.stringify(errorData)}`); }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                    let text = result.candidates[0].content.parts[0].text;
                    text = text.replace(/\n\n+/g, '</p><p>'); text = text.replace(/\n/g, '<br>'); text = `<p>${text}</p>`;
                    text = text.replace(/<p><br>/g, '<p>').replace(/<br><\/p>/g, '</p>');
                    text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');     
                    text = text.replace(/<br>(\d+\.\s)/g, '</p><ol><li>$1'); text = text.replace(/<br>([\-\*]\s)/g, '</p><ul><li>');
                    text = text.replace(/<br>(\d+\.\s)/g, '</li><li>$1'); text = text.replace(/<br>([\-\*]\s)/g, '</li><li>');
                    text = text.replace(/<\/li>(?!<li>)/g, '</li></ul></p>'); text = text.replace(/<\/li>(?!<li>)/g, '</li></ol></p>');
                    setContentResponse(text);
                } else { setContentResponse("<p>No se pudo obtener una respuesta v√°lida de la IA.</p>"); }
            } catch (error) { console.error("Error calling Gemini API:", error); setContentResponse(`<p>Error: ${error.message}</p>`); }
        }
        
        async function fetchVerseTextWithGemini(verseRef, modalTitlePrefix = "Texto B√≠blico") {
            contentModalTitle.textContent = `${modalTitlePrefix}: ${verseRef}`;
            showContentModal();
            showContentLoading();
            const prompt = `Por favor, proporciona el texto completo de ${verseRef} seg√∫n la Nueva Traducci√≥n Viviente (NTV). Si es un rango de vers√≠culos o m√∫ltiples vers√≠culos no contiguos, muestra el texto de todos ellos, indicando claramente cada referencia. Formatea la respuesta como HTML sem√°ntico, usando p√°rrafos (<p>) para cada bloque de texto y, si es apropiado, encabezados (<h5>) para t√≠tulos o secciones dentro de la respuesta. Aseg√∫rate de que los n√∫meros de los vers√≠culos sean visibles y distintivos (por ejemplo, usando <strong> o una clase 'verse-number'). Evita usar saltos de l√≠nea (<br>) excesivos; prefiere p√°rrafos para la estructura.`;
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                 if (!response.ok) { const errorData = await response.json(); throw new Error(`API Error: ${response.status} ${response.statusText}. Details: ${JSON.stringify(errorData)}`); }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                    let text = result.candidates[0].content.parts[0].text;
                    text = text.replace(/\n\n+/g, '</p><p>'); text = text.replace(/\n/g, '<br>'); text = `<p>${text}</p>`;
                    text = text.replace(/<p><br>/g, '<p>').replace(/<br><\/p>/g, '</p>'); 
                    text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    text = text.replace(/(\b\d+[:\.]\d+[-]?\d*\b)/g, '<strong class="verse-number">$1</strong>'); 
                    setContentResponse(`<div>${text}</div>`);
                } else { setContentResponse("<p>No se pudo obtener el texto del vers√≠culo.</p>"); }
            } catch (error) { console.error("Error fetching verse text with Gemini:", error); setContentResponse(`<p>Error al obtener vers√≠culo: ${error.message}</p>`); }
        }

        function setActiveSection(targetId) {
            allContentSections.forEach(section => {
                section.classList.remove('active');
                if (section.id === targetId) {
                    section.classList.add('active');
                }
            });
            // Update nav button active states
            navButtons.forEach(btn => {
                 btn.classList.toggle('active', btn.dataset.tab === targetId);
            });
            mobileMenuNavButtons.forEach(btn => {
                 btn.classList.toggle('active', btn.dataset.tab === targetId);
            });

            window.scrollTo(0, 0); // Scroll to top
        }
        
        // Initial active section (Home)
        setActiveSection('home');
        
        homeButton.addEventListener('click', () => {
            setActiveSection('home');
            mobileMenu.classList.add('hidden');
        });

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                setActiveSection(button.dataset.tab);
            });
        });
        mobileMenuNavButtons.forEach(button => {
            button.addEventListener('click', () => {
                setActiveSection(button.dataset.tab);
                mobileMenu.classList.add('hidden');
            });
        });

        exploreSectionButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetSectionId = button.dataset.targetSection;
                setActiveSection(targetSectionId);
                if (targetSectionId === 'despues') {
                    const firstSubTab = document.querySelector('.sub-tab-button[data-subtab="persa"]');
                    if (firstSubTab) handleSubTabClick(firstSubTab);
                }
            });
        });
        
        const profetasAccordionContainer = document.getElementById('profetasAntesAccordion');
        profetasAntesData.forEach(profeta => {
            const item = document.createElement('div');
            item.classList.add('accordion-item');
            item.innerHTML = `
                <div class="accordion-header flex justify-between items-center">
                    <span class="text-xl font-semibold text-slate-800">${profeta.nombre}</span>
                    <span class="arrow text-2xl">&#x276F;</span>
                </div>
                <div class="accordion-content">
                    <p class="mb-3 text-slate-600">${profeta.mensaje}</p>
                    <p class="text-sm text-slate-500 mb-4"><strong>Vers√≠culos Clave:</strong> ${profeta.versiculos}</p>
                    <div class="flex flex-wrap gap-3">
                        <button class="action-button gemini-button profeta-gemini-btn" data-profeta-nombre="${profeta.nombre}" data-profeta-versiculos="${profeta.versiculos}">‚ú® Profundizar Mensaje</button>
                        <button class="action-button verse-modal-button profeta-verse-btn" data-verse-ref="${profeta.versiculos}" data-profeta-nombre="${profeta.nombre}">üìñ Ver Vers√≠culos (NTV)</button>
                    </div>
                </div>
            `;
            profetasAccordionContainer.appendChild(item);
        });

        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', function() { this.parentElement.classList.toggle('active'); });
        });

        document.querySelectorAll('.profeta-gemini-btn').forEach(button => {
            button.addEventListener('click', function() {
                const nombreProfeta = this.dataset.profetaNombre;
                const versiculosProfeta = this.dataset.profetaVersiculos;
                const prompt = `Explica con m√°s detalle el mensaje del profeta ${nombreProfeta} en relaci√≥n con el exilio babil√≥nico, incluyendo su contexto hist√≥rico, temas principales y la relevancia de los vers√≠culos clave: ${versiculosProfeta}. Formatea la respuesta como HTML sem√°ntico, usando p√°rrafos (<p>), listas (<ul>, <ol>), y si es apropiado, encabezados (<h5>) para estructurar la informaci√≥n. Evita usar saltos de l√≠nea (<br>) excesivos; prefiere p√°rrafos para la estructura. Mant√©n un tono informativo y adecuado para un contexto de estudio b√≠blico.`;
                callGeminiAPIForAnalysis(prompt, `An√°lisis: Mensaje de ${nombreProfeta}`);
            });
        });

        document.querySelectorAll('.profeta-verse-btn').forEach(button => {
            button.addEventListener('click', function() {
                fetchVerseTextWithGemini(this.dataset.verseRef, `Vers√≠culos de ${this.dataset.profetaNombre}`);
            });
        });

        document.querySelector('main').addEventListener('click', function(event) {
            if (event.target.matches('.verse-in-text-trigger')) {
                fetchVerseTextWithGemini(event.target.dataset.verseRef);
            }
        });
        
        function populateTable(tableId, data, columns) {
            const tbody = document.getElementById(tableId);
            if (!tbody) return;
            tbody.innerHTML = ''; 
            data.forEach(item => {
                const row = tbody.insertRow();
                columns.forEach(column => {
                    const cell = row.insertCell();
                    cell.textContent = item[column.key] || '';
                    cell.className = 'px-6 py-4 whitespace-nowrap text-sm'; 
                    if(columns.indexOf(column) === 0) cell.classList.add('font-medium', 'text-slate-900');
                    else cell.classList.add('text-slate-600');
                });
            });
        }

        populateTable('tablaReyesAntes', reyesAntesDelExilioData, [ { key: 'nombre' }, { key: 'fechas' }, { key: 'eventos' } ]);
        populateTable('tablaFigurasDurante', figurasDuranteData, [ { key: 'nombre' }, { key: 'rol' }, { key: 'ubicacion' }, { key: 'notas' } ]);
        populateTable('tablaGobernadoresPersa', gobernadoresPersaData, [ { key: 'nombre' }, { key: 'fechas' }, { key: 'logros' } ]);
        populateTable('tablaGobernadoresAsmoneos', gobernadoresAsmoneosData, [ { key: 'nombre' }, { key: 'titulo' }, { key: 'fechas' }, { key: 'eventos' } ]);
        populateTable('tablaGobernadoresRomanos', gobernadoresRomanosData, [ { key: 'nombre' }, { key: 'titulo' }, { key: 'fechas' }, { key: 'notas' } ]);

        mobileMenuButton.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); });

        const subTabs = document.querySelectorAll('.sub-tab-button');
        const subContents = document.querySelectorAll('.sub-content-section');

        function handleSubTabClick(subTab) {
            const subTarget = subTab.dataset.subtab;
            subTabs.forEach(st => st.classList.remove('active'));
            subTab.classList.add('active');
            subContents.forEach(subContent => {
                subContent.classList.add('hidden'); 
                if (subContent.id === subTarget) subContent.classList.remove('hidden');
            });
        }
        subTabs.forEach(subTab => { subTab.addEventListener('click', () => handleSubTabClick(subTab)); });
        
        // Chart.js configurations
        const chartBaseOptions = {
            indexAxis: 'y', responsive: true, maintainAspectRatio: false,
            scales: { x: { beginAtZero: false, ticks: { color: '#475569' }, grid: { color: '#e2e8f0' } }, y: { ticks: { color: '#475569' }, grid: { display: false } } },
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(15, 23, 42, 0.85)', titleColor: '#f1f5f9', bodyColor: '#cbd5e1', padding: 12, cornerRadius: 6,
                    titleFont: { weight: 'bold', size: 14 }, bodyFont: { size: 12 },
                    callbacks: {
                        label: function(context) { return `${context.raw.nombre}: ${context.raw.fechas}`; },
                        afterLabel: function(context) { const e = context.raw.eventos || context.raw.logros || context.raw.notas; return e ? e.substring(0,100) + (e.length > 100 ? '...' : '') : ''; }
                    }
                }
            },
            onClick: (event, elements) => {
                if (elements.length > 0) {
                    const chartElement = elements[0];
                    const data = event.chart.data.datasets[chartElement.datasetIndex].data[chartElement.index];
                    const detalleDivId = event.chart.canvas.id.replace('Chart', 'Detalle');
                    const detalleDiv = document.getElementById(detalleDivId);
                    if (detalleDiv) {
                        let htmlContent = `<h4 class="text-xl font-semibold text-slate-800 mb-2">${data.nombre} (${data.fechas})</h4>`;
                        if(data.detalles) htmlContent += `<p class="mb-4 text-slate-600">${data.detalles}</p>`;
                        else if (data.eventos || data.logros || data.notas) htmlContent += `<p class="mb-4 text-slate-600">${data.eventos || data.logros || data.notas}</p>`;
                        const geminiButton = document.createElement('button');
                        geminiButton.className = 'action-button gemini-button ruler-gemini-btn';
                        geminiButton.innerHTML = '‚ú® Analizar Impacto';
                        geminiButton.onclick = function() {
                            const prompt = `Analiza el impacto y la importancia del reinado o gobierno de ${data.nombre} (${data.fechas}) en el contexto de los eventos relacionados con el exilio babil√≥nico (antes, durante o despu√©s). Considera sus decisiones clave, el clima socio-pol√≠tico y las consecuencias de sus acciones seg√∫n los relatos b√≠blicos e hist√≥ricos. Formatea la respuesta como HTML sem√°ntico, usando p√°rrafos (<p>), listas (<ul>, <ol>), y si es apropiado, encabezados (<h5>) para estructurar la informaci√≥n. Evita usar saltos de l√≠nea (<br>) excesivos; prefiere p√°rrafos para la estructura.`;
                            callGeminiAPIForAnalysis(prompt, `An√°lisis: Impacto de ${data.nombre}`);
                        };
                        detalleDiv.innerHTML = htmlContent;
                        detalleDiv.appendChild(geminiButton);
                        detalleDiv.classList.remove('hidden');
                    }
                }
            }
        };
        
        function createTimelineChart(canvasId, rawData, labelField = 'nombre', startField = 'startYear', endField = 'endYear', isBC = true) {
            const ctx = document.getElementById(canvasId)?.getContext('2d');
            if (!ctx) return;
            const transformedData = rawData.map(item => {
                const [datePart1, datePart2] = item.fechas.split('‚Äì');
                let start = parseInt(datePart1.replace(/c\.\s*|a\.C\.|d\.C\.|\(.*?\)/g, '').trim());
                let end = datePart2 ? parseInt(datePart2.replace(/c\.\s*|a\.C\.|d\.C\.|\(.*?\)/g, '').trim()) : start;
                return { ...item, [startField]: isBC ? start : -start, [endField]: isBC ? end : -end };
            });
            const years = transformedData.flatMap(d => [d[startField], d[endField]]);
            let minYear = Math.min(...years); let maxYear = Math.max(...years);
            const chartData = {
                labels: transformedData.map(d => d[labelField]),
                datasets: [{
                    label: 'Reinado/Gobierno',
                    data: transformedData.map(d => ({ x: isBC ? [d[endField], d[startField]] : [-d[startField], -d[endField]], y: d[labelField], nombre: d.nombre, fechas: d.fechas, eventos: d.eventos, logros: d.logros, notas: d.notas, detalles: d.detalles })),
                    backgroundColor: `rgba(14, 165, 233, 0.6)`, // sky-500
                    borderColor: `rgba(2, 132, 199, 1)`, // sky-600
                    borderWidth: 1, barPercentage: 0.7, categoryPercentage: 0.9, borderRadius: 4
                }]
            };
            let specificOptions = JSON.parse(JSON.stringify(chartBaseOptions)); 
            if (isBC) {
                specificOptions.scales.x.reverse = true;
                specificOptions.scales.x.ticks.callback = function(value) { return Math.abs(value) + ' a.C.'; };
                specificOptions.scales.x.min = maxYear - 5; specificOptions.scales.x.max = minYear + 5; 
            } else { 
                specificOptions.scales.x.reverse = false;
                specificOptions.scales.x.ticks.callback = function(value) { return Math.abs(value) + ' d.C.'; };
                specificOptions.scales.x.min = Math.abs(maxYear) - 5; specificOptions.scales.x.max = Math.abs(minYear) + 5; 
            }
            new Chart(ctx, { type: 'bar', data: chartData, options: specificOptions });
        }
        
        createTimelineChart('reyesAntesChart', reyesAntesDelExilioData, 'nombre', 'startYear', 'endYear', true);
        createTimelineChart('gobernadoresPersaChart', gobernadoresPersaData, 'nombre', 'startYear', 'endYear', true);
        createTimelineChart('gobernadoresAsmoneoChart', gobernadoresAsmoneosData, 'nombre', 'startYear', 'endYear', true);
        
        const gobernadoresRomanosProcessedData = gobernadoresRomanosData.map(g => {
            const isAC = g.fechas.includes('a.C.');
            let startNum, endNum; const dates = g.fechas.split('‚Äì');
            startNum = parseInt(dates[0].replace(/\D/g, ''));
            endNum = dates.length > 1 ? parseInt(dates[1].replace(/\D/g, '')) : startNum;
            return { ...g, startYear: isAC ? startNum : -startNum, endYear: isAC ? endNum : -endNum, isBCPeriod: isAC };
        });
        createTimelineChart('gobernadoresRomanoChart', gobernadoresRomanosProcessedData, 'nombre', 'startYear', 'endYear', false);

    });
</script>
</body>
</html>
